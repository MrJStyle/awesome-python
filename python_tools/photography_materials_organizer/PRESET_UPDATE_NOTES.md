# 预设配置功能更新说明

## 更新概览

已成功将底部的"使用示例"改造为交互式的"预设配置管理"功能。用户现在可以：

1. ✅ 从本地 JSON 文件加载预设配置
2. ✅ 点击预设按钮快速填充表单（除日期外）
3. ✅ 保存新的预设配置到 JSON 文件
4. ✅ 删除不需要的预设配置

## 更改的文件

### 1. 新增文件：`presets.json`
存储所有预设配置的 JSON 文件，包含三个预设示例：
- 整理 iPhone 拍摄的视频
- 整理相机拍摄的照片
- 整理无人机拍摄的所有媒体文件

### 2. 修改文件：`video_organizer_ui.py`

#### 新增导入
```python
import json  # 用于处理 JSON 文件
```

#### 新增函数
- `load_presets()`: 从 JSON 文件加载预设配置
- `save_preset()`: 保存新预设到 JSON 文件
- `delete_preset()`: 删除指定预设
- `load_preset_values()`: 加载预设值到表单
- `save_preset_handler()`: 保存预设的事件处理器
- `delete_preset_handler()`: 删除预设的事件处理器

#### UI 改动
将原来的静态"使用示例" Accordion 替换为交互式的"预设配置" Accordion，包含：

1. **使用预设配置区域**
   - 动态生成预设按钮（从 JSON 文件读取）
   - 点击按钮自动填充表单

2. **删除预设配置区域**
   - 下拉选择要删除的预设
   - 删除按钮确认删除

3. **保存新预设配置区域**
   - 输入预设名称
   - 保存按钮将当前表单值保存为预设

### 3. 更新文件：`README.md`
- 在功能特点中添加了"预设配置管理"功能
- 新增"使用预设配置"章节，详细说明：
  - 如何使用预设
  - 如何保存新预设
  - 如何删除预设
  - 预设配置文件的格式

## 功能特性

### 1. 加载预设
- 从 `presets.json` 文件读取所有预设
- 动态生成预设按钮
- 点击按钮自动填充：源文件夹、目标文件夹、设备名称、文件类型
- **日期字段不会被填充**（按需求保留为空）

### 2. 保存预设
- 验证必填字段（预设名称、源文件夹、目标文件夹、设备名称）
- 如果预设名称已存在，则更新该预设
- 如果是新名称，则添加新预设
- 保存后显示成功消息

### 3. 删除预设
- 下拉菜单显示所有可删除的预设
- 删除后更新 JSON 文件
- 显示删除成功消息

### 4. 预设文件格式
```json
[
    {
        "name": "预设名称",
        "from_dir": "源文件夹路径",
        "to_dir": "目标文件夹路径",
        "device_name": "设备名称",
        "file_type": "video|image|all"
    }
]
```

## 使用流程

### 使用预设快速填充表单
1. 打开 Web UI
2. 展开"💡 预设配置" Accordion（默认展开）
3. 点击任意预设按钮（如："📌 整理 iPhone 拍摄的视频"）
4. 表单自动填充预设值
5. 手动选择日期（如果需要）
6. 点击"🚀 开始整理"

### 保存新预设
1. 在表单中填写完整配置信息
2. 在"保存新预设配置"区域输入预设名称
3. 点击"💾 保存预设"按钮
4. 看到成功消息后，刷新页面即可看到新预设按钮

### 删除预设
1. 在"删除预设配置"区域的下拉菜单中选择预设
2. 点击"🗑️ 删除"按钮
3. 看到成功消息后，刷新页面预设按钮即消失

## 技术实现细节

1. **JSON 文件路径**: 使用 `Path(__file__).parent / "presets.json"` 确保文件在脚本同目录
2. **错误处理**: 所有 JSON 操作都有 try-except 保护
3. **同名处理**: 保存预设时检查名称是否已存在，存在则更新
4. **UI 刷新**: 使用 Gradio 的事件系统实时更新界面
5. **日期排除**: 预设不包含日期字段，保持原有的日期手动选择功能

## 注意事项

1. 预设文件 `presets.json` 位于项目目录下，可以手动编辑
2. 删除预设后需要刷新页面才能看到按钮消失（Gradio 限制）
3. 保存预设后同样需要刷新页面才能看到新按钮
4. 日期字段不会被预设填充，需要手动选择
5. JSON 文件使用 UTF-8 编码，支持中文

## 测试建议

1. ✅ 测试加载预设按钮
2. ✅ 测试点击预设填充表单
3. ✅ 测试保存新预设
4. ✅ 测试更新已存在的预设
5. ✅ 测试删除预设
6. ✅ 测试表单验证（空字段）
7. ✅ 测试日期不被预设影响
8. ✅ 测试中文字符支持

## 下一步优化建议（可选）

1. 添加预设编辑功能（而不是只能删除再添加）
2. 添加预设导入/导出功能
3. 添加预设排序功能
4. 保存/删除预设后自动刷新按钮区域（需要 Gradio 高级功能）
5. 添加预设分类/标签功能
